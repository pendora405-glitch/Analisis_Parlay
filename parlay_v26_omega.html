<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Parlay Titan v26 Ω (Omega) – Clean</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#0b1220;
      color:#e5e7eb;
      margin:0;
      padding:0;
    }
    .container{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }
    h1,h2,h3,h4{
      margin:0 0 6px 0;
      font-weight:600;
    }
    h1{font-size:20px;}
    h2{font-size:16px;margin-top:16px;}
    .grid{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .col{
      flex:1 1 320px;
      background:#020617;
      border-radius:10px;
      padding:10px;
      border:1px solid #1f2937;
    }
    input,select,textarea{
      width:100%;
      box-sizing:border-box;
      margin-bottom:6px;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #1f2937;
      background:#020617;
      color:#e5e7eb;
      font-size:12px;
    }
    textarea{min-height:52px;resize:vertical;}
    label{
      font-size:11px;
      opacity:0.8;
      display:block;
      margin-top:2px;
    }
    .btn{
      display:inline-block;
      padding:8px 12px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:12px;
      background:#6366f1;
      color:#fff;
      margin:4px 4px 4px 0;
    }
    .btn.secondary{
      background:#111827;
      border:1px solid #374151;
    }
    .btn.danger{
      background:#b91c1c;
    }
    .btn:disabled{
      opacity:0.5;
      cursor:default;
    }
    .section-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.06em;
      opacity:0.7;
      margin-bottom:4px;
    }
    .tag{
      display:inline-block;
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      background:#111827;
      border:1px solid #1f2937;
      margin-right:4px;
      margin-bottom:2px;
    }
    .result-box{
      background:#020617;
      border-radius:10px;
      padding:10px;
      border:1px solid #1f2937;
      margin-top:12px;
      font-size:12px;
    }
    .result-row{
      display:flex;
      justify-content:space-between;
      margin-bottom:3px;
    }
    .small-note{
      font-size:10px;
      opacity:0.8;
    }
    .pill{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #374151;
      font-size:10px;
      margin-right:4px;
      margin-bottom:2px;
    }
    .auto-block{
      margin:4px 0 8px 0;
    }
    .auto-btn{
      margin:2px;
      padding:4px 8px;
      font-size:10px;
      background:#075985;
      color:#e5e7eb;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
    .auto-btn:hover{
      background:#0e7490;
    }
    .muted{
      opacity:0.75;
      font-size:11px;
    }
    .divider{
      border-top:1px dashed #1f2937;
      margin:8px 0;
    }
    @media (max-width:640px){
      .result-row{flex-direction:column;align-items:flex-start;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Parlay Titan v26 Ω (Omega)</h1>
  <div class="small-note">
    Engine: XG+ v6 · PCS v6 Ω · Tactical DNA v3 · Defensive Grid v4 · ICM v26 · Momentum/Tempo/Transition/PressTrap ·
    OU Neutralizer · Risk & Convergence Controller · Tanpa bias Over/Under.
  </div>

  <!-- ================= UI INPUT ================= -->
  <h2>Data Pertandingan</h2>
  <div class="grid">
    <div class="col">
      <div class="section-title">HOME</div>
      <input id="h_name" placeholder="Nama Tim Home">
      <input id="h_shots" placeholder="Shots per game">
      <input id="h_sot" placeholder="Shots on target per game">
      <input id="h_prog" placeholder="Progressive passes / carries">
      <input id="h_final3" placeholder="Final third entries">
      <input id="h_poss" placeholder="Possession %">
      <input id="h_xg" placeholder="xG per game (jika ada)">
      <input id="h_gc" placeholder="Goals conceded per game">
      <input id="h_shotsC" placeholder="Shots conceded per game">
      <input id="h_elo" placeholder="ELO Rating">
      <input id="h_build" placeholder="Build quality (1–10)">
      <input id="h_rest" placeholder="Rest days">
      <input id="h_rotation" placeholder="Rotation level (0–10)">
      <input id="h_press" placeholder="Press style (low/medium/high/gegenpress)">
      <input id="h_inter" placeholder="Interceptions per game">
      <textarea id="h_abs" placeholder="Absensi (GK:1; DF:1; MD:0; FW:2)"></textarea>

      <div class="auto-block">
        <button class="auto-btn" onclick="autoBuildUp('h')">AUTO BUILD</button>
        <button class="auto-btn" onclick="autoDefense('h')">AUTO DEF</button>
        <button class="auto-btn" onclick="autoImportance('h')">AUTO IMPORTANCE</button>
        <button class="auto-btn" onclick="autoRotation('h')">AUTO ROTATION</button>
        <button class="auto-btn" onclick="autoPress('h')">AUTO PRESS</button>
        <button class="auto-btn" onclick="autoFinish('h')">AUTO FINISH Q</button>
      </div>

      <label>Importance weight</label>
      <input id="h_imp" placeholder="1.00 (boleh dikosongkan)">
      <label>Finishing quality (0.1–1.0)</label>
      <input id="h_finishQ" placeholder="0.10–1.00 (boleh auto)">
    </div>

    <div class="col">
      <div class="section-title">AWAY</div>
      <input id="a_name" placeholder="Nama Tim Away">
      <input id="a_shots" placeholder="Shots per game">
      <input id="a_sot" placeholder="Shots on target per game">
      <input id="a_prog" placeholder="Progressive passes / carries">
      <input id="a_final3" placeholder="Final third entries">
      <input id="a_poss" placeholder="Possession %">
      <input id="a_xg" placeholder="xG per game (jika ada)">
      <input id="a_gc" placeholder="Goals conceded per game">
      <input id="a_shotsC" placeholder="Shots conceded per game">
      <input id="a_elo" placeholder="ELO Rating">
      <input id="a_build" placeholder="Build quality (1–10)">
      <input id="a_rest" placeholder="Rest days">
      <input id="a_rotation" placeholder="Rotation level (0–10)">
      <input id="a_press" placeholder="Press style (low/medium/high/gegenpress)">
      <input id="a_inter" placeholder="Interceptions per game">
      <textarea id="a_abs" placeholder="Absensi (GK:1; DF:1; MD:0; FW:2)"></textarea>

      <div class="auto-block">
        <button class="auto-btn" onclick="autoBuildUp('a')">AUTO BUILD</button>
        <button class="auto-btn" onclick="autoDefense('a')">AUTO DEF</button>
        <button class="auto-btn" onclick="autoImportance('a')">AUTO IMPORTANCE</button>
        <button class="auto-btn" onclick="autoRotation('a')">AUTO ROTATION</button>
        <button class="auto-btn" onclick="autoPress('a')">AUTO PRESS</button>
        <button class="auto-btn" onclick="autoFinish('a')">AUTO FINISH Q</button>
      </div>

      <label>Importance weight</label>
      <input id="a_imp" placeholder="1.00 (boleh dikosongkan)">
      <label>Finishing quality (0.1–1.0)</label>
      <input id="a_finishQ" placeholder="0.10–1.00 (boleh auto)">
    </div>

    <div class="col">
      <div class="section-title">Konteks Laga</div>
      <select id="comp_mode">
        <option value="">Tipe Kompetisi (Opsional)</option>
        <option value="league">Liga</option>
        <option value="cup">Cup / Knockout</option>
        <option value="international">Antar Negara</option>
        <option value="friendly">Friendly</option>
      </select>
      <select id="match_type">
        <option value="">Tipe Laga (Opsional)</option>
        <option value="normal">Normal</option>
        <option value="derby">Derby</option>
        <option value="title">Title Race</option>
        <option value="relegation">Relegation Battle</option>
        <option value="final">Final</option>
      </select>
      <select id="weather">
        <option value="">Cuaca (Opsional)</option>
        <option value="normal">Normal</option>
        <option value="rain">Hujan</option>
        <option value="snow">Salju</option>
        <option value="hot">Panas</option>
      </select>

      <div class="divider"></div>
      <div class="section-title">Pasar (Opsional · tidak menggeser OU)</div>
      <input id="odds_home" placeholder="Odds 1">
      <input id="odds_draw" placeholder="Odds X">
      <input id="odds_away" placeholder="Odds 2">
      <input id="line_ou" placeholder="Line Over/Under (mis: 2.5)">
      <input id="odds_over" placeholder="Odds Over (opsional)">
      <input id="odds_under" placeholder="Odds Under (opsional)">
      <div class="small-note muted">
        Pasar hanya dipakai sebagai info & deteksi trap, <b>tidak memaksa Over/Under condong</b>.
      </div>

      <div class="divider"></div>
      <button class="btn" onclick="analyzeMatch_v26Omega()">ANALYZE v26 Ω</button>
      <button class="btn secondary" onclick="clearAll()">Clear</button>
    </div>
  </div>

  <!-- ================= HASIL ================= -->
  <h2>Hasil Analisis v26 Ω</h2>
  <div id="result_box" class="result-box">
    <div class="small-note muted">Isi data lalu klik <b>ANALYZE v26 Ω</b>.</div>
  </div>
</div>

<script>
/* ========= CORE HELPER ========= */
function safeNum(v, def=0){
  const n = Number(v);
  return Number.isFinite(n) ? n : def;
}
function clamp(v,min,max){
  return Math.max(min,Math.min(max,v));
}
function roundTo(x,p=3){
  const k = Math.pow(10,p);
  return Math.round((x||0)*k)/k;
}
function poisson(k,lambda){
  k = k|0;
  if(lambda<=0) return (k===0)?1:0;
  if(k<0) return 0;
  // simple iterative poiss
  let p = Math.exp(-lambda);
  for(let i=0;i<k;i++){
    p *= lambda/(i+1);
  }
  return p;
}
function prob3W(lambdaH,lambdaA){
  let pH=0,pD=0,pA=0;
  const maxG = 10;
  for(let gh=0;gh<=maxG;gh++){
    const ph = poisson(gh,lambdaH);
    for(let ga=0;ga<=maxG;ga++){
      const pa = poisson(ga,lambdaA);
      const joint = ph*pa;
      if(gh>ga) pH+=joint;
      else if(gh===ga) pD+=joint;
      else pA+=joint;
    }
  }
  const s = pH+pD+pA || 1;
  return { H:pH/s, D:pD/s, A:pA/s };
}

/* ========= AUTO INPUT ENGINE (ringan, netral) ========= */
function val(id){
  const el=document.getElementById(id);
  return el?el.value:"";
}
function setVal(id,v){
  const el=document.getElementById(id);
  if(el) el.value=v;
}
function num(id,def=0){
  return safeNum(val(id),def);
}
function op(s){ return s==="h"?"a":"h"; }

/* AUTO BUILD QUALITY (1–10) */
function autoBuildUp(s){
  const shots = num(s+"_shots");
  const prog  = num(s+"_prog");
  const f3    = num(s+"_final3");
  const poss  = num(s+"_poss");

  let score = 0;
  score += shots/3;
  score += prog/25;
  score += f3/30;
  score += (poss-50)/10;

  score = clamp(score,1,10);
  setVal(s+"_build",Math.round(score));
}

/* AUTO DEFENSIVE DIFFICULTY */
function autoDefense(s){
  const gc   = num(s+"_gc");
  const shC  = num(s+"_shotsC");
  const inter= num(s+"_inter");

  let d = 6;
  d -= gc*0.5;
  d -= shC*0.2;
  d += inter*0.15;

  d = clamp(d,1,10);
  // disimpan di _deflvl (internal)
  setVal(s+"_deflvl",Math.round(d));
}

/* AUTO IMPORTANCE (1.0 ±) */
function autoImportance(s){
  const comp = val("comp_mode");
  const mtype= val("match_type");
  const name = val(s+"_name").toLowerCase();
  const abs  = val(s+"_abs").toLowerCase();

  let imp = 1.0;

  if(comp==="cup" || comp==="international") imp += 0.10;
  if(mtype==="derby") imp += 0.06;
  if(mtype==="title" || mtype==="final") imp += 0.14;
  if(mtype==="relegation") imp += 0.10;

  if(name.includes("u19") || name.includes("u21") || comp==="friendly") imp -= 0.10;

  if(abs.includes("fw") || abs.includes("md") || abs.includes("df")) imp -= 0.05;

  imp = clamp(imp,0.75,1.3);
  setVal(s+"_imp",roundTo(imp,2));
}

/* AUTO ROTATION (0–10) */
function autoRotation(s){
  const abs = val(s+"_abs").toLowerCase();
  const rest= num(s+"_rest",3);
  let r = 0;
  if(abs.includes("fw")) r++;
  if(abs.includes("md")) r++;
  if(abs.includes("df")) r++;
  if(abs.includes("gk")) r+=0.5;
  if(rest<=2) r+=1.5;
  r = clamp(r,0,10);
  setVal(s+"_rotation",roundTo(r,1));
}

/* AUTO PRESS STYLE */
function autoPress(s){
  const poss = num(s+"_poss");
  const prog = num(s+"_prog");
  let p="medium";
  if(prog>=30 && poss>=55) p="high";
  if(prog>=34) p="gegenpress";
  if(poss<=42) p="low";
  setVal(s+"_press",p);
}

/* AUTO FINISHING QUALITY (0.1–1.0) */
function autoFinish(s){
  const sh  = num(s+"_shots");
  const sot = num(s+"_sot");
  let fq = 0.3;
  if(sh>0) fq = clamp(sot/Math.max(sh,1),0.1,1.0);
  setVal(s+"_finishQ",roundTo(fq,2));
}

/* ========= PARSER ABSENSI ========= */
function parseAbs(str){
  const out={GK:0,DF:0,MD:0,FW:0};
  if(!str) return out;
  const parts=str.split(";");
  for(const p of parts){
    const seg=p.split(":");
    if(seg.length!==2) continue;
    const key=seg[0].trim().toUpperCase();
    const valN=safeNum(seg[1],0);
    if(out.hasOwnProperty(key)) out[key]=valN;
  }
  return out;
}

/* ========= XG+ v6 Ω (wrapper di atas stats dasar) ========= */
function xg6Omega(team, opp){
  const shots = safeNum(team.shots,0);
  const sot   = safeNum(team.sot,0);
  const poss  = safeNum(team.poss,50);
  const prog  = safeNum(team.prog,0);
  const f3    = safeNum(team.final3,0);
  const xgIn  = safeNum(team.xg,0);

  // base chance quality
  let baseXg = shots*0.08 + sot*0.05;
  baseXg += prog*0.015 + f3*0.02;
  baseXg *= clamp(0.8 + (poss-50)*0.006, 0.7, 1.3);

  if(xgIn>0){
    baseXg = (baseXg*0.4 + xgIn*0.6);
  }
  baseXg = clamp(baseXg,0.1,3.5);

  // simple location / chain proxies
  const loc = clamp((f3+prog/2)/20,0.3,2.0);
  const chain = clamp((prog+shots)/15,0.3,2.0);
  const finQ = safeNum(team.finishQ,0.4);

  return {
    xg: roundTo(baseXg*clamp(0.8+finQ*0.4,0.7,1.4),3),
    loc, chain, finQ
  };
}

/* ========= PCS v6 Ω (ringkas, netral) ========= */
function pcs_v6_omega(h,a){
  // target xG ikut XG+, jauhkan dari overbias
  const hX = xg6Omega(h,a);
  const aX = xg6Omega(a,h);
  const baseH = hX.xg;
  const baseA = aX.xg;

  // sedikit koreksi defense lawan
  const defH = clamp(a.defLvl || 5,1,10);
  const defA = clamp(h.defLvl || 5,1,10);

  const lambdaH = clamp(baseH * (11-defH)/8, 0.1, 4.5);
  const lambdaA = clamp(baseA * (11-defA)/8, 0.1, 4.5);

  return { H: roundTo(lambdaH,3), A: roundTo(lambdaA,3), meta:{hX,aX} };
}

/* ========= ICM v26 – Absensi Impact ========= */
function icm_v26(absStr){
  const p = parseAbs(absStr);
  let atkMul = 1, defMul = 1;
  atkMul -= p.FW*0.07 + p.MD*0.03;
  defMul -= p.DF*0.05 + p.GK*0.08;
  atkMul = clamp(atkMul,0.7,1.05);
  defMul = clamp(defMul,0.7,1.05);
  return { atkMul, defMul };
}

/* ========= Momentum / Tempo / Transition / PressTrap ========= */
function momentumScore(team){
  const shots = safeNum(team.shots,0);
  const sot   = safeNum(team.sot,0);
  const prog  = safeNum(team.prog,0);
  const f3    = safeNum(team.final3,0);
  const poss  = safeNum(team.poss,50);

  let m = 0;
  m += shots*0.5;
  m += sot*0.8;
  m += prog*0.15;
  m += f3*0.25;
  m += (poss-50)*0.3;
  return roundTo(clamp(m/10,0,10),2);
}

function tempoRating(team){
  const poss = safeNum(team.poss,50);
  const prog = safeNum(team.prog,0);
  let t = (prog/4) + (100-poss)/3;
  return roundTo(clamp(t/10,0,10),2);
}

function transitionThreat(team, opp){
  const prog = safeNum(team.prog,0);
  const inter= safeNum(opp.inter,0);
  let s = prog*0.18 + inter*0.18;
  return roundTo(clamp(s/5,0,10),2);
}

function pressTrapRisk(team){
  const build = safeNum(team.build,5);
  const press = (team.press||"medium").toLowerCase();
  let p = 5;
  if(build<=3) p+=2;
  if(build>=8) p-=1;
  if(press==="high"||press==="gegenpress") p+=1;
  if(press==="low") p-=1;
  return roundTo(clamp(p,0,10),2);
}

/* ========= Reliability & Convergence ========= */
function reliabilityScore(h,a){
  // cek kelengkapan & konsistensi
  function scoreTeam(t){
    let s = 0;
    if(t.shots>0 && t.sot>=0) s+=1.5;
    if(t.poss>0) s+=1;
    if(t.prog>0) s+=1;
    if(t.final3>0) s+=1;
    if(t.xg>0) s+=1.5;
    if(t.gc>=0 && t.shotsC>=0) s+=1;
    if(t.elo>0) s+=1;
    return clamp(s/7,0,1); // 0–1
  }
  const rH = scoreTeam(h);
  const rA = scoreTeam(a);
  return {
    H:rH,A:rA,
    global: (rH+rA)/2
  };
}

function convergenceController(lambdaH,lambdaA,rel){
  // jika data kurang kuat → jangan terlalu ekstrim (dekatkan ke 1.2–1.4)
  const target = 1.3;
  const weight = clamp(1-rel.global,0,0.7);
  const adjH = lambdaH*(1-weight)+target*weight;
  const adjA = lambdaA*(1-weight)+target*weight;
  return { H:adjH, A:adjA };
}

/* ========= Risk Engine (OU netral) ========= */
function riskEngine(lambdaH,lambdaA,ctx){
  const baseVar = clamp(lambdaH+lambdaA,0.2,8);
  // tekanan laga penting → var sedikit turun (lebih hati-hati)
  let varMult = 1.0;
  if(ctx.importance>1.05) varMult *= 0.95;
  if(ctx.matchType==="friendly") varMult *= 0.9;

  // cuaca jelek → sedikit turunkan gol
  let weatherMult = 1.0;
  if(ctx.weather==="rain" || ctx.weather==="snow") weatherMult *= 0.95;
  if(ctx.weather==="hot") weatherMult *= 0.97;

  return {
    varMult: roundTo(clamp(varMult,0.8,1.1),3),
    lambdaMult: roundTo(clamp(weatherMult,0.9,1.05),3),
    baseVar: roundTo(baseVar,3)
  };
}

/* ========= Baca UI ⇒ Objek Tim ========= */
function buildTeam(prefix){
  return {
    side: prefix,
    name: val(prefix+"_name")|| (prefix==="h"?"Home":"Away"),
    shots: num(prefix+"_shots"),
    sot: num(prefix+"_sot"),
    prog: num(prefix+"_prog"),
    final3: num(prefix+"_final3"),
    poss: num(prefix+"_poss",50),
    xg: num(prefix+"_xg"),
    gc: num(prefix+"_gc"),
    shotsC: num(prefix+"_shotsC"),
    elo: num(prefix+"_elo",1500),
    build: num(prefix+"_build",5),
    rest: num(prefix+"_rest",3),
    rotation: num(prefix+"_rotation",0),
    press: val(prefix+"_press")||"medium",
    inter: num(prefix+"_inter"),
    absRaw: val(prefix+"_abs"),
    abs: parseAbs(val(prefix+"_abs")),
    imp: num(prefix+"_imp",1),
    finishQ: num(prefix+"_finishQ",0.4)
  };
}

/* ========= Market Reader ========= */
function readMarket(){
  const oh = num("odds_home",0);
  const od = num("odds_draw",0);
  const oa = num("odds_away",0);
  const lineOU = num("line_ou",0);
  const oo = num("odds_over",0);
  const ou = num("odds_under",0);
  const have1x2 = (oh>0 && od>0 && oa>0);
  const haveOU  = (lineOU>0 && oo>0 && ou>0);

  let prob = null;
  if(have1x2){
    const invH=1/oh, invD=1/od, invA=1/oa;
    const sum=invH+invD+invA;
    prob = {
      H:invH/sum,
      D:invD/sum,
      A:invA/sum,
      margin: sum-1
    };
  }
  let ouInfo = null;
  if(haveOU){
    const invO=1/oo, invU=1/ou;
    const sum=invO+invU;
    ouInfo = {
      line: lineOU,
      over: invO/sum,
      under: invU/sum,
      margin: sum-1
    };
  }

  return { prob, ouInfo };
}

/* ========= FINAL ENGINE v26 Ω ========= */
function analyzeMatch_v26Omega(){
  const h = buildTeam("h");
  const a = buildTeam("a");

  // derived defense level untuk PCS
  h.defLvl = safeNum(h.defLvl, 11 - clamp((h.gc*1.3 + h.shotsC*0.3 - a.shots*0.2),0,10));
  a.defLvl = safeNum(a.defLvl, 11 - clamp((a.gc*1.3 + a.shotsC*0.3 - h.shots*0.2),0,10));

  const comp = val("comp_mode")||"league";
  const mtype= val("match_type")||"normal";
  const weather = val("weather")||"normal";

  // XG+6 & PCS6
  const pcs = pcs_v6_omega(h,a);
  let lambdaH = pcs.H;
  let lambdaA = pcs.A;

  // ICM (absensi)
  const icmH = icm_v26(h.absRaw);
  const icmA = icm_v26(a.absRaw);
  lambdaH *= icmH.atkMul / icmA.defMul;
  lambdaA *= icmA.atkMul / icmH.defMul;

  // importance
  const impH = clamp(h.imp || 1,0.7,1.4);
  const impA = clamp(a.imp || 1,0.7,1.4);
  const globalImp = (impH+impA)/2;

  // home advantage ringan (netral OU)
  let homeAdv = 1.03;
  if(comp==="international") homeAdv = 1.02;
  if(comp==="friendly") homeAdv = 1.0;
  lambdaH *= homeAdv;

  // momentum & tempo & transition

  const momH = momentumScore(h);

  const momA = momentumScore(a);

  const tH   = tempoRating(h);

  const tA   = tempoRating(a);

  const trH  = transitionThreat(h,a);

  const trA  = transitionThreat(a,h);

  const trapH= pressTrapRisk(h);

  const trapA= pressTrapRisk(a);



  // sedikit penyesuaian λ berbasis momentum, tetapi simetris & dijaga

  const momDiff = clamp((momH-momA)/20,-0.18,0.18);

  lambdaH *= (1 + momDiff);

  lambdaA *= (1 - momDiff);



  // tempo ekstrem → sedikit ke arah under/over, tapi dikontrol riskEngine (netral)

  const tempoAvg = (tH+tA)/2;



  // reliability & convergence

  const rel = reliabilityScore(h,a);

  const conv = convergenceController(lambdaH,lambdaA,rel);

  lambdaH = conv.H;

  lambdaA = conv.A;



  // risk engine (var dan sedikit weather)

  const risk = riskEngine(lambdaH,lambdaA,{importance:globalImp,matchType:comp,weather});

  lambdaH *= risk.lambdaMult;

  lambdaA *= risk.lambdaMult;



  // clamp final

  lambdaH = clamp(lambdaH,0.05,5.5);

  lambdaA = clamp(lambdaA,0.05,5.5);



  const p3 = prob3W(lambdaH,lambdaA);



  // OU probability purely from λ (tidak pakai odds)

  const lineOU = num("line_ou",2.5);

  const maxG = 10;

  let pOver=0,pUnder=0;

  for(let gh=0;gh<=maxG;gh++){

    const ph=poisson(gh,lambdaH);

    for(let ga=0;ga<=maxG;ga++){

      const pa=poisson(ga,lambdaA);

      const joint=ph*pa;

      if(gh+ga>lineOU) pOver+=joint;

      else pUnder+=joint;

    }

  }

  const ouSum = pOver+pUnder || 1;

  pOver/=ouSum; pUnder/=ouSum;



  // market info (hanya insight, bukan paksaan)

  const market = readMarket();



  // build output

  renderResult_v26Omega({

    lambdaH,lambdaA,

    p3,

    pOver,pUnder,lineOU,

    h,a,

    momentum:{H:momH,A:momA},

    tempo:{H:tH,A:tA},

    transition:{H:trH,A:trA},

    pressTrap:{H:trapH,A:trapA},

    reliability:rel,

    risk,

    importance:{H:impH,A:impA,global:globalImp},

    market

  });

}



/* ========= RENDER HASIL ========= */

function renderResult_v26Omega(res){

  const box=document.getElementById("result_box");

  if(!box) return;

  const hName=res.h.name||"Home";

  const aName=res.a.name||"Away";



  const ph = Math.round(res.p3.H*100);

  const pd = Math.round(res.p3.D*100);

  const pa = Math.round(res.p3.A*100);



  const pov = Math.round(res.pOver*100);

  const pun = Math.round(res.pUnder*100);



  const relPct = Math.round(res.reliability.global*100);



  const trapNote = (()=> {

    const t = (res.pressTrap.H+res.pressTrap.A)/2;

    if(t>=8) return "High press-trap risk";

    if(t>=6) return "Moderate press-trap risk";

    return "Press-trap wajar";

  })();



  const momText = (res.momentum.H>res.momentum.A)

    ? `${hName} sedikit unggul momentum`

    : (res.momentum.A>res.momentum.H)

      ? `${aName} sedikit unggul momentum`

      : "Momentum relatif seimbang";



  const riskNote = (res.risk.baseVar>3.2)

    ? "Laga cenderung variatif (bisa swing)."

    : "Laga cenderung lebih terkendali.";



  const html = `

    <div class="result-row">

      <div><strong>${hName}</strong> vs <strong>${aName}</strong></div>

      <div>

        <span class="pill">v26 Ω</span>

        <span class="pill">Reliability: ${relPct}%</span>

        <span class="pill">λ: ${roundTo(res.lambdaH,2)} – ${roundTo(res.lambdaA,2)}</span>

      </div>

    </div>



    <div class="result-row">

      <div>

        <div><b>Prob 1X2 (murni statistik):</b></div>

        <div>1 : ${ph}% · X : ${pd}% · 2 : ${pa}%</div>

      </div>

      <div>

        <div><b>Over/Under (netral, dari λ):</b></div>

        <div>Line ${res.lineOU || 2.5} ⇒ Over: ${pov}% · Under: ${pun}%</div>

      </div>

    </div>



    <div class="divider"></div>

    <div class="result-row">

      <div>

        <div class="section-title">Advanced Profile</div>

        <div class="small-note">

          Momentum: ${hName} ${res.momentum.H} · ${aName} ${res.momentum.A}<br>

          Tempo: ${hName} ${res.tempo.H} · ${aName} ${res.tempo.A}<br>

          Transition threat: ${hName} ${res.transition.H} · ${aName} ${res.transition.A}<br>

          Press-trap risk: ${hName} ${res.pressTrap.H} · ${aName} ${res.pressTrap.A}

        </div>

      </div>

      <div>

        <div class="section-title">Context & Risk</div>

        <div class="small-note">

          Importance (avg): ${roundTo(res.importance.global,2)} · Var base: ${res.risk.baseVar}<br>

          Risk engine λ-mult: ${res.risk.lambdaMult} · var-mult: ${res.risk.varMult}<br>

          ${riskNote}<br>

          ${trapNote}<br>

          ${momText}

        </div>

      </div>

    </div>



    ${renderMarketInsight(res.market)}

  `;



  box.innerHTML=html;

}



function renderMarketInsight(mkt){

  if(!mkt || (!mkt.prob && !mkt.ouInfo)) return "";

  let out = `<div class="divider"></div><div class="section-title">Market Insight (informasi saja, tidak menggeser OU)</div><div class="small-note">`;

  if(mkt.prob){

    const pH=Math.round(mkt.prob.H*100);

    const pD=Math.round(mkt.prob.D*100);

    const pA=Math.round(mkt.prob.A*100);

    out += `Book: 1 : ${pH}% · X : ${pD}% · 2 : ${pA}% (margin ≈ ${roundTo(mkt.prob.margin*100,2)}%)<br>`;

  }

  if(mkt.ouInfo){

    out += `Book OU ${mkt.ouInfo.line} ⇒ Over ${Math.round(mkt.ouInfo.over*100)}% · Under ${Math.round(mkt.ouInfo.under*100)}% (margin ≈ ${roundTo(mkt.ouInfo.margin*100,2)}%)<br>`;

  }

  out += `Gunakan sebagai konfirmasi / deteksi trap, bukan patokan utama.</div>`;

  return out;

}



/* ========= UTIL: CLEAR ========= */

function clearAll(){

  const ids = document.querySelectorAll("input,textarea");

  ids.forEach(el=>{

    if(el.type==="button") return;

    el.value="";

  });

  const box=document.getElementById("result_box");

  if(box) box.innerHTML='<div class="small-note muted">Input dikosongkan.</div>';

}

</script>

</body>

</html>

